<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat-App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100" rel="stylesheet" />
</head>
<body class="bg-black min-h-screen flex flex-col items-center justify-center">
    <div class="w-full max-w-md mx-auto bg-gray-800 text-white rounded-xl shadow-lg overflow-hidden">
        <div class="text-center text-2xl font-bold py-4 border-b border-gray-700">Chat - WebApp</div>
        <div class="flex flex-col h-96">
            <!-- chat box -->
            <div id="chat" class="flex-1 p-4 overflow-y-auto bg-gray-900 text-left flex flex-col space-y-4">
                <!-- Messages will be dynamically added here -->
            </div>
            <!-- input area -->
            <div class="p-4 border-t border-gray-700 bg-gray-800">
                <div class="flex items-center">
                    <input type="text" id="text" class="flex-1 p-2 rounded-lg bg-gray-700 text-white outline-none" placeholder="Type a message...">
                    <button id="send" class="ml-2 px-4 py-2 bg-blue-600 rounded-lg">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get the user's name from the query parameter
        var urlParams = new URLSearchParams(window.location.search);
        var name = urlParams.get('name');
        if (!name) {
            name = "Guest" + Math.floor(Math.random() * 1000);
        }

        var url = "ws://" + window.location.host + "/ws";
        var ws = new WebSocket(url);

        var chat = document.getElementById("chat");
        var text = document.getElementById("text");

        ws.onmessage = function (msg) {
            var messageData = msg.data.split("> ");
            var username = messageData[0].replace("<", "").replace(">", "");
            var message = messageData[1]; // Extract the message content

            if (username !== name) {
                var div = document.createElement("div");
                div.className = "chat-message self-start bg-blue-500 text-white max-w-xs rounded-lg px-3 py-1.5 text-sm";
                div.innerHTML = `<span class="text-xs font-semibold">${username}</span><br>${message}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight; // Scroll to bottom
            }
        };

        text.onkeydown = function (e) {
            if (e.keyCode === 13 && text.value !== "") {
                sendMessage();
            }
        };

        document.getElementById("send").onclick = function () {
            if (text.value !== "") {
                sendMessage();
            }
        };

        function sendMessage() {
            var message = text.value;
            ws.send("<" + name + "> " + message);
            var div = document.createElement("div");
            div.className = "chat-message self-end bg-zinc-500 text-white max-w-xs rounded-lg px-3 py-1.5 text-sm";
            div.innerHTML = `<span class="text-xs font-semibold">${name}</span><br>${message}`;
            chat.appendChild(div);
            text.value = "";
            chat.scrollTop = chat.scrollHeight; // Scroll to bottom
        }
    </script>
</body>
</html>
